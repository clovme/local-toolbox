const utils={toast:{newToast:()=>{const e={Alert(e){t({...o,...e,buttons:{...o.buttons,...e.buttons||{}}},"alert")},Confirm(e){t({...o,...e,buttons:{...o.buttons,...e.buttons||{}}},"confirm")},Notify(e){const t={...i,...e};if("top"===t.location)t.location="locationT";else t.location="locationR";!function(e){let t=document.querySelector(`.me-notification-container.${e.location}.${e.tipSort}`);t||(t=document.createElement("div"),t.className=`me-notification-container ${e.location} ${e.tipSort}`,t.style.zIndex=n("tips"),document.body.appendChild(t));const o=document.createElement("div");o.className="notification-capsule",o.style.height="0px";const i=document.createElement("div");if(i.className="notification",e.type){i.classList.add("carrystate",e.type);const t=document.createElement("i");t.className="notification-icon icon-state me-notification--motion me-message-box--showicon",i.appendChild(t),t.addEventListener("animationend",(e=>e.stopPropagation()))}if(e.title){const t=document.createElement("div");t.className="title me-notification--motion me-motion--inlinecon",t.textContent=e.title,i.appendChild(t),t.addEventListener("animationend",(e=>e.stopPropagation()))}if(e.content){const t=document.createElement("div");t.className="con me-notification--motion me-motion--inlinecon",i.querySelector(".title")&&(t.style.marginTop="5px"),t.textContent=e.content,t.style.animationDelay=".3s",i.appendChild(t),t.addEventListener("animationend",(e=>e.stopPropagation()))}"top"===e.tipSort&&t.children.length>0?t.insertBefore(o,t.firstChild):t.appendChild(o);if(e.closable){const e=document.createElement("div");e.className="me-notification-close";const t=document.createElement("button");t.type="button",t.className="close",e.appendChild(t),t.addEventListener("click",(()=>c())),i.appendChild(e)}let a="me-notification-show--right",s="me-notification-hide--right";"locationT"===e.location&&(a="me-notification-show--top",s="me-notification-hide--top");function c(){o.style.height=o.offsetHeight+"px",i.classList.remove(a),i.classList.add(s),i.addEventListener("animationend",(()=>{i.remove(),o.style.height="0",o.addEventListener("transitionend",(()=>{o.remove(),"function"==typeof e.callback&&e.callback(),0===t.children.length&&t.remove()}),{once:!0})}),{once:!0})}o.appendChild(i),o.style.height=i.offsetHeight+10+"px",o.addEventListener("transitionend",(()=>{document.body.style.overflowX="hidden"})),i.classList.add("me-notification--motion",a),i.addEventListener("animationend",(function t(n){if(o.style.height="auto",document.body.style.overflowX="initial","number"==typeof e.showtime)if(e.progressBar){const t=document.createElement("div");t.className="processbar";const n=document.createElement("div");n.className="me-notification--motion me-notification--process",n.style.animationDuration=e.showtime/1e3+"s",n.addEventListener("animationend",(e=>{c(),e.stopPropagation()})),t.appendChild(n),i.appendChild(t),i.addEventListener("mouseover",(()=>{n.style.animationPlayState="paused"})),i.addEventListener("mouseout",(()=>{n.style.animationPlayState="running"}))}else setTimeout((()=>c()),e.showtime);n.stopPropagation(),i.removeEventListener("animationend",t)}))}(t)},alert:{normal:function(t,n,o){e.Alert({title:t,content:n,callback:o})},success:function(t,n,o){e.Alert({title:t,content:n,type:"success",callback:o})},warning:function(t,n,o){e.Alert({title:t,content:n,type:"warning",callback:o})},error:function(t,n,o){e.Alert({title:t,content:n,type:"error",callback:o})}},confirm:{question:function(t,n,o){e.Confirm({title:t,content:n,callback:o})},warning:function(t,n,o){e.Confirm({title:t,content:n,type:"warning",callback:o})},success:function(t,n,o){e.Confirm({title:t,content:n,type:"success",callback:o})},error:function(t,n,o){e.Confirm({title:t,content:n,type:"error",callback:o})}},toast:{normal:function(t){e.Notify({content:t,showtime:3e3,location:"top"})},success:function(t){e.Notify({content:t,type:"success",showtime:3e3,location:"top"})},warning:function(t){e.Notify({content:t,type:"warning",showtime:3e3,location:"top"})},error:function(t){e.Notify({content:t,type:"error",showtime:3e3,location:"top"})},info:function(t){e.Notify({content:t,type:"info",showtime:3e3,location:"top"})}},notify:{normal:function(t,n="通知"){e.Notify({title:n,content:t,showtime:3e3})},success:function(t,n="通知"){e.Notify({title:n,content:t,type:"success",showtime:3e3})},warning:function(t,n="通知"){e.Notify({title:n,content:t,type:"warning",showtime:3e3})},error:function(t,n="通知"){e.Notify({title:n,content:t,type:"error",showtime:3e3})},info:function(t,n="通知"){e.Notify({title:n,content:t,type:"info",showtime:3e3})}}};function t(e,t){const o=n("messagebox"),i=document.createElement("div");i.className="me-message-box-bg",i.style.display="block";const a=document.createElement("div");a.className="me-message-box-alert",o>=99999&&(i.style.zIndex=o-1,a.style.zIndex=o);const s=document.createElement("div");s.className="distop",a.appendChild(s);const c=document.createElement("div");if(c.className="msgcontainer",a.appendChild(c),"confirm"===t){const t=e.type&&"none"!==e.type?e.type:"question";e.type=t;const n=document.createElement("div");n.className=`icon ${t}`,c.appendChild(n)}else if(e.type&&"none"!==e.type){const t=document.createElement("div");t.className=`icon ${e.type}`,c.appendChild(t)}if(e.title){const t=document.createElement("div");t.className="msgtitle",t.textContent=e.title,c.appendChild(t)}if(e.content){const t=document.createElement("div");t.className="msgcon",t.textContent=e.content,c.appendChild(t)}const l=document.createElement("div");l.className="operatebar",a.appendChild(l);const r=document.createElement("button");r.type="button",r.textContent=e.buttons.confirm.text;const d=document.createElement("button");switch(d.type="button",d.textContent=e.buttons.cancel.text,d.className="cancel",e.type){case"success":r.classList.add("success");break;case"question":r.classList.add("normal");break;case"warning":r.classList.add("warning");break;case"error":r.classList.add("error");break;default:r.classList.add("normal"),c.classList.add("typenone")}if("alert"===t?l.appendChild(r):"confirm"===t?(l.appendChild(r),l.appendChild(d),r.classList.add("beleft"),d.classList.add("beright")):l.appendChild(r),document.querySelectorAll(".me-message-box-alert").length>0){const e=setInterval((()=>{document.querySelectorAll(".me-message-box-alert").length<=0&&(clearInterval(e),m())}),500)}else m();function m(){function n(){const e=window.innerHeight-s.offsetHeight-l.offsetHeight-120,t=a.querySelector("div.msgcon");t&&(t.style.maxHeight=`${e<=100?100:e}px`)}e.aero&&(document.body.style.overflowX="hidden",i.classList.add("aero")),document.body.appendChild(i),document.body.appendChild(a),window.innerWidth<parseInt(getComputedStyle(a).maxWidth)&&(a.style.maxWidth=window.innerWidth-10+"px"),n(),window.addEventListener("resize",n),i.classList.add("me-message-box--motion","me-message-box-bg--show"),a.style.left=(window.innerWidth-a.offsetWidth)/2+"px",a.style.top=(window.innerHeight-a.offsetHeight)/2+"px",a.style.display="block",a.classList.add("me-message-box--motion","me-message-box-alert--open"),a.addEventListener("animationend",(()=>{a.classList.remove("me-message-box-alert--open"),i.addEventListener("mousedown",(()=>{a.classList.add("me-message-box--leap"),a.addEventListener("animationend",(()=>{a.classList.remove("me-message-box--leap"),d?d.focus():r.focus()}),{once:!0})}))}),{once:!0});const o=a.querySelector("div.icon");o&&o.classList.add("me-message-box--showicon","me-message-box--motion"),function(){"alert"===t?r.focus():d.focus();d.addEventListener("click",(()=>u(!1))),r.addEventListener("click",(()=>u(!0)))}()}function u(t){a.classList.remove("me-message-box-alert--open"),a.classList.add("me-message-box-alert--close"),a.addEventListener("animationend",(()=>{document.body.style.overflowX="initial",a.remove(),"function"==typeof e.callback&&e.callback(t)}),{once:!0}),i.classList.remove("me-message-box-bg--show"),i.classList.add("me-message-box-bg--hide"),i.style.animationDelay=".3s",i.addEventListener("animationend",(()=>i.remove()),{once:!0})}}function n(e){let t=0;switch(e){case"messagebox":default:break;case"news":{const e=document.querySelector(".me-message-box-alert");if(e){t=parseFloat(getComputedStyle(e).zIndex)-3}break}case"tips":{const e=document.querySelector(".me-notification-container");if(e){t=parseFloat(getComputedStyle(e).zIndex)+1}break}}if(t<=0){const e=Array.from(document.body.querySelectorAll("*")).map((e=>{const t=getComputedStyle(e);return"static"!==t.position&&parseInt(t.zIndex,10)||-1})).filter((e=>e>=0));t=e.length>0?Math.max(...e):-1,(t<=0||"auto"===t)&&(t=9999)}return t}const o={title:"",content:"",type:"none",aero:!0,buttons:{confirm:{text:"确定"},cancel:{text:"取消"}},callback:()=>{}},i={title:"",content:"",location:"right",tipSort:"top",type:"",duration:null,closable:!0,progressBar:!0,callback:null};window.meMsg=e||{}},createTippy:(e,t="")=>{const n=document.querySelector(`[data-validate="${e}"]`);return n._tippy||tippy(n,{content:t,trigger:"manual",placement:"right",animation:"scale",hideOnClick:!1,interactive:!0}),n._tippy.setContent(t),n._tippy}},currentTime:async(e="second")=>(await axios.get("/public/time")).data[e],storage:{set:(e,t=null)=>{t?localStorage.setItem(`${clientId}-${t}`,e):localStorage.setItem(clientId,e)},get:(e=null)=>e?localStorage.getItem(`${clientId}-${e}`):localStorage.getItem(clientId),remove:(e=null)=>{e&&localStorage.removeItem(`${clientId}-${e}`),localStorage.removeItem(clientId)}},validateForm:(e,t,n)=>{const o=document.querySelector(e),i=e=>{if("hidden"===e.getAttribute("type"))return!0;const t=e.getAttribute("name");if(!t||!n[t])return!0;const i=n[t](e.value,o),a=utils.toast.createTippy(t,"");return i?(a.setContent(i),a.show(),e.classList.add("is-invalid"),e.classList.remove("is-valid"),!1):e.checkValidity()?(a.hide(),e.classList.remove("is-invalid"),e.classList.add("is-valid"),!0):(a.hide(),e.classList.add("is-invalid"),e.classList.remove("is-valid"),!0)};o.querySelectorAll("[name]").forEach((e=>{e.addEventListener("input",(()=>{i(e)}))})),o.querySelector('button[data-type="submit"]').addEventListener("click",(()=>{let e=!1;o.querySelectorAll("[name]").forEach((t=>{i(t)||(e=!0)})),e||(t(o),o.classList.add("was-validated"))}))},onSwitchCaptcha:()=>{const e=document.querySelector('div[data-validate="captcha"]'),t=document.querySelector("img");e.querySelector("input").value="",t.src="/public/captcha.png?t="+(new Date).getTime()},applySystemTheme:()=>{const e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";document.documentElement.setAttribute("data-bs-theme",e)}},eventListener={addLoadEventListener:e=>{window.addEventListener("load",e)},globalEmailValidateSend:(e,t,n)=>{const o=document.querySelector(e),i=document.querySelector(t),a=document.querySelector(n);function s(e,t=0){return e-t}async function c(e){const t=utils.storage.get("time");if(!t)return void utils.storage.remove("form");e||(e=await utils.currentTime());let n=parseInt(t,10);if(isNaN(n)||n<0)return utils.storage.remove("time"),void utils.storage.remove("form");const a=utils.storage.get("form");if(a)Object.entries(JSON.parse(a)).forEach((([e,t])=>{i.elements[e].value=t}));else{let e=new FormData(i),t={};e.forEach(((e,n)=>{t[n]=e})),utils.storage.set(JSON.stringify(t),"form")}o.setAttribute("disabled","disabled"),o.innerHTML=`发送验证码(<i>${s(n-e)}</i>s)`;let c=setInterval((()=>{if(s(n-e)<=0)return clearInterval(c),o.innerHTML="重新发送验证码",o.removeAttribute("disabled"),utils.storage.remove("time"),void utils.storage.remove("form");o.setAttribute("disabled","disabled"),o.innerHTML=`发送验证码(<i>${s(n-e)}</i>s)`,e++}),1e3)}c(),o.addEventListener("click",(function(){if(!/^[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}$/.test(a.value))return void meMsg.toast.warning("请输入正确的邮箱地址！");const e={email:a.value};axios.post("/public/email/code",e).then((async e=>{const t=await utils.currentTime();meMsg.toast.success(e.message),utils.storage.set((t+60).toString(),"time"),await c(t)}))}))},globalOnSwitchCaptcha:(e,t)=>{document.querySelector(e).addEventListener("click",(function(){utils.onSwitchCaptcha()})),document.querySelector(t).addEventListener("focus",(function(){utils.onSwitchCaptcha()}))}};eventListener.addLoadEventListener((()=>{utils.toast.newToast(),utils.applySystemTheme(),matchMedia("(prefers-color-scheme: dark)").addEventListener("change",utils.applySystemTheme);const e=document.getElementById("logoutBtn");e&&e.addEventListener("click",(()=>{meMsg.confirm.question("注销提示","是否确认注销当前登录用户！",(function(e){e&&axios.post("/logout").then((e=>{1e4===e.code?(utils.storage.remove("time"),utils.storage.remove("form"),localStorage.removeItem("TOKEN"),location.reload()):meMsg.toast.warning(e.message)}))}))}))}));