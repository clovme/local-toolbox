import{d as G,u as Z,n as te,r as x,q as oe,a as y,c as L,o as f,e as t,b as d,P as z,w as g,F as j,s as W,v as k,k as U,x as X,f as F,t as N,V as D,_ as J,y as Y,z as Q,A as le,h as ae}from"./index-Bwdf-Qxb.js";import{b as se,t as ee}from"./index-B03c0uGm.js";import{g as ie,o as re,p as ue,d as ce}from"./article-DJgbimAs.js";import{u as ne}from"./article-DL0Z1R9R.js";const de={class:"article-content-box"},ve={class:"article-content-search"},me={class:"article-content-tool"},pe={class:"article-content-list-box"},fe={class:"title-box"},_e={class:"options-time"},ye={class:"options-box"},ge=["onClick"],he={class:"time"},xe={class:"article-content-list-right"},Le=G({__name:"ArticleContent",setup(H){const u=Z(),s=te(),r=x([]),v=ne(),m=x(u.query.kw),o=a=>{D.modal.confirm({title:"删除提示",content:`删除《${a.title}》？`,escClosable:!0,status:"warning",maskClosable:!0,draggable:!1,destroyOnClose:!0}).then(l=>{l==="confirm"&&re("delete",a).then(h=>{D.modal.message({content:h.message,status:"success"}),m.value=u.query.kw,v.setTreeList(),v.setArticleList(u.query),v.setCategory(u.query,s)})})};oe(()=>u.query,a=>{m.value=a.kw,v.setArticleList(a)}),ie().then(a=>{r.value=[],se(a.data).forEach(l=>{l.name!=="all"&&r.value.push(l)})});const b=()=>{let a=u.query.cid,l=u.query.type;if(u.query.type==="all"){for(const h of r.value)if(h.name==="default"){a=h.id,l=h.name;break}}s.push({name:"EditArticle",params:{type:"add"},query:{cid:a,type:l}})},_=()=>{s.push({name:"Article",query:{...u.query,kw:m.value}})};return v.setArticleList(u.query),(a,l)=>{const h=y("vxe-input"),C=y("vxe-button"),A=y("router-link"),P=y("vxe-text-ellipsis");return f(),L("div",de,[t(z,{class:"article-content-tools"},{default:g(()=>[d("div",ve,[t(h,{onChange:_,"max-length":"50","show-word-count":"",modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=n=>m.value=n),placeholder:"请输入搜索内容",type:"search"},null,8,["modelValue"]),t(C,{onClick:_,content:"搜索"})]),d("div",me,[t(C,{onClick:b,status:"danger",content:"新的创作","prefix-icon":"vxe-icon-add"})])]),_:1}),d("div",pe,[t(z,{class:"article-content-list-content"},{default:g(()=>[(f(!0),L(j,null,W(k(v).articleTags.articleList,n=>(f(),L("div",{class:"article-content-list-item",key:n.id},[d("div",fe,[k(u).query.type==="all"?(f(),U(A,{key:0,class:"title-category",to:{name:"Article",query:{cid:n.categoryID,type:n.categoryName}}},{default:g(()=>[F(N(n.categoryTitle),1)]),_:2},1032,["to"])):X("",!0),t(A,{class:"title-content",to:{name:"Preview",query:{id:n.id,cid:n.categoryID,type:n.categoryName}}},{default:g(()=>[F(N(n.title),1)]),_:2},1032,["to"])]),t(P,{class:"summary","line-clamp":"5",content:n.summary},null,8,["content"]),d("div",_e,[d("div",ye,[t(A,{class:"options-box-edit",to:{name:"EditArticle",query:{id:n.id,cid:n.categoryID,type:n.categoryName},params:{type:"edit"}}},{default:g(()=>[...l[1]||(l[1]=[F("编辑",-1)])]),_:1},8,["to"]),d("a",{onClick:$=>o(n),class:"options-box-delete",href:"javascript:void(0)"},"删除",8,ge)]),d("div",he,[d("span",null,N(k(ee)(n.createdAt))+"前发表",1),d("span",null,N(k(ee)(n.updatedAt))+"前更新",1)])])]))),128))]),_:1}),d("div",xe,[t(z,{class:"article-content-list-right-card"},{default:g(()=>[(f(!0),L(j,null,W(k(v).articleTags.tags,(n,$)=>(f(),U(A,{to:{name:"Article",query:{...k(u).query,kw:n}},key:$},{default:g(()=>[F(N(n),1)]),_:2},1032,["to"]))),128))]),_:1})])])])}}}),we=J(Le,[["__scopeId","data-v-ea070b59"]]),ke={class:"vxe-menu--item-link-title"},be={class:"vxe-menu--item-link-option-title"},Ce={key:0,class:"vxe-menu--item-group"},Ae=G({name:"ArticleNavContent",__name:"ArticleNavContent",props:{level:{},navList:{}},emits:["add","edit","delete","up","down"],setup(H,{emit:u}){const s=H,r=u,v=Z(),m=x({icon:!0,isExpand:!0}),o=Y(()=>s.level??1),b=Y(()=>String(s.navList.id)===v.query.id?!0:s.navList.children?.length?s.navList.children.some(e=>_(e)):!1);function _(e){return String(e.id)===v.query.id?!0:e.children?.length?e.children.some(R=>_(R)):!1}function a(){m.value.icon=!m.value.icon,m.value.isExpand=!m.value.isExpand}const l=x(null),h=x(null),C=x(null);function A(e){const w=e.currentTarget.getBoundingClientRect();clearTimeout(C.value),clearTimeout(h.value),h.value=window.setTimeout(()=>{if(!l.value){const c=document.createElement("ul");c.className="menu-item-options",c.style.position="fixed",c.style.padding="5px";const S=document.createElement("li");if(S.style.color="#409eff",S.innerHTML="添加新分类",S.addEventListener("click",M=>{M.stopPropagation(),r("add",s.navList),n()}),s.navList.name!=="all"&&s.navList.name!=="default"){const M=document.createElement("li");M.style.color="#67c23a",M.innerHTML=`编辑 [<b>${s.navList.title}</b>] 信息`,M.addEventListener("click",K=>{K.stopPropagation(),r("edit",s.navList),n()});const B=document.createElement("li");B.style.color="#f56c6c",B.innerHTML=`删除 [<b>${s.navList.title}</b>] 分类`,B.addEventListener("click",K=>{K.stopPropagation(),r("delete",s.navList),n()}),c.append(S,M,B)}else c.append(S);c.addEventListener("mouseenter",()=>{clearTimeout(C.value)}),c.addEventListener("mouseleave",()=>{C.value=window.setTimeout(()=>{n()},100)}),l.value=c}const V=l.value;document.body.appendChild(V);const q=V.offsetHeight,T=window.innerHeight;let E=w.top-q/2;E<0?E=5:E+q>T&&(E=T-q-5),V.style.left=`${w.right}px`,V.style.top=`${E}px`},200)}function P(){clearTimeout(h.value),C.value=window.setTimeout(()=>{n()},100)}function n(){l.value&&l.value.parentNode&&(l.value.parentNode.removeChild(l.value),l.value=null)}function $(e){r("add",e)}function i(e){r("edit",e)}function p(e){r("delete",e)}function O(e){r("up",e)}function I(e){r("down",e)}return(e,R)=>{const w=y("vxe-icon"),V=y("router-link"),q=y("ArticleNavContent",!0);return f(),L("div",{class:Q(["vxe-menu--item-wrapper",{["vxe-menu--item-level"+o.value]:!0,"is--expand":m.value.isExpand,"is--exact-active":k(v).query.cid===`${e.navList.id}`,"is--active":b.value}])},[t(V,{to:{name:"Article",query:{cid:e.navList.id,type:e.navList.name}},class:"vxe-menu--item-link"},{default:g(()=>[d("div",{class:Q({"vxe-menu--item-link-icon":!0,"vxe-menu--item-link-icon--is-option":e.navList.name!=="all"&&e.navList.name!=="default"})},[t(w,{name:"file-markdown"}),t(w,{name:"information"})],2),d("div",ke,[d("div",be,N(e.navList.title),1),d("div",{class:Q({"vxe-menu--item-link-option-children":!e.navList.children?.length})},[d("div",{onMouseenter:A,onMouseleave:P,class:"vxe-menu--item-link-option"},[d("span",null,N(e.navList.articleCount<100?e.navList.articleCount:"99+"),1),t(w,{name:"ellipsis-v"})],32)],2)]),e.navList.children?.length?(f(),L("div",{key:0,class:"vxe-menu--item-link-collapse",onClick:le(a,["stop","prevent"])},[m.value.icon?(f(),U(w,{key:0,name:"arrow-down"})):(f(),U(w,{key:1,name:"arrow-left"}))])):X("",!0)]),_:1},8,["to"]),e.navList.children?.length?(f(),L("div",Ce,[(f(!0),L(j,null,W(e.navList.children,T=>(f(),U(q,{onUp:O,onDown:I,onAdd:$,onEdit:i,onDelete:p,navList:T,key:T.id,level:o.value+1},null,8,["navList","level"]))),128))])):X("",!0)],2)}}}),Ve=J(Ae,[["__scopeId","data-v-c4d30390"]]),qe={class:"vxe-menu"},Te={class:"vxe-menu--item-list"},Ee=G({name:"ArticleNav",__name:"ArticleNav",props:{modelValue:{}},emits:["update:modelValue","add","edit","delete"],setup(H,{emit:u}){const s=H,r=u,v=Y({get:()=>s.modelValue,set:_=>r("update:modelValue",_)});function m(_){r("add",_)}function o(_){r("edit",_)}function b(_){r("delete",_)}return(_,a)=>(f(),L("div",qe,[d("div",Te,[(f(!0),L(j,null,W(v.value,l=>(f(),U(Ve,{onAdd:m,onEdit:o,onDelete:b,navList:l,key:l.id},null,8,["navList"]))),128))])]))}}),Ne=J(Ee,[["__scopeId","data-v-52eb0737"]]),$e={class:"article-box"},Ie={class:"article-category-title"},Me=G({__name:"ArticleView",setup(H){const u=Z(),s=te(),r=x(!1),v=x(!1),m=x("添加文档分类"),o=x({description:"",id:"",pid:"",sort:0,title:""}),b=x(""),_={keyField:"value",expandAll:!0,parentField:"pid"},a=ne(),l=()=>{ue(r.value,o.value).then(i=>{v.value=!1,D.modal.message({content:i.message,status:"success"}),a.setTreeList(),a.setCategory(u.query,s)})},h=()=>{D.modal.message({content:"重置事件",status:"info"})};function C(i){r.value=!0,o.value.id="0",o.value.pid=i.name!=="all"&&i.name!=="default"?i.id:"0",o.value.sort=0,m.value="添加文档分类",v.value=!0}function A(i){r.value=!1,o.value.id=i.id,o.value.pid=i.pid,o.value.title=i.title,o.value.sort=i.sort,o.value.description=i.description,m.value=`编辑[${i.title}]分类信息`,v.value=!0}function P(i){D.modal.confirm({title:"删除提示",content:`是否删除[${i.title}]分类信息？`,escClosable:!0,status:"warning",maskClosable:!0,draggable:!1,destroyOnClose:!0}).then(p=>{p==="confirm"&&ce(i).then(O=>{if(D.modal.message({content:O.message,status:"success"}),i.pid==="0"){if(!b.value){for(const I of a.categoryList)if(I.name==="default"){b.value=I.id;break}}s.push({name:"Article",query:{cid:b.value,type:"default"}})}else s.push({name:"Article",query:{cid:i.pid,type:i.name}});a.setTreeList(),a.setCategory(u.query,s)})})}const n=()=>new Promise(i=>{o.value={},i(null)}),$=ae({title:[{required:!0,content:"分类名称不能为空"}]});return a.setTreeList(),a.setCategory(u.query,s),(i,p)=>{const O=y("vxe-icon"),I=y("vxe-input"),e=y("vxe-form-item"),R=y("vxe-tree-select"),w=y("vxe-number-input"),V=y("vxe-textarea"),q=y("vxe-button"),T=y("vxe-form"),E=y("vxe-modal");return f(),L("div",$e,[t(z,{class:"article-category-box"},{default:g(()=>[d("div",Ie,[t(O,{name:"file-word"}),p[6]||(p[6]=d("span",null,"文章分类列表",-1))]),t(Ne,{onAdd:C,onEdit:A,onDelete:P,modelValue:k(a).categoryList,"onUpdate:modelValue":p[0]||(p[0]=c=>k(a).categoryList=c)},null,8,["modelValue"])]),_:1}),t(we),t(E,{"before-hide-method":n,title:m.value,modelValue:v.value,"onUpdate:modelValue":p[5]||(p[5]=c=>v.value=c),width:400,draggable:!1,"lock-scroll":"",destroyOnClose:!0},{default:g(()=>[t(T,{vertical:"","title-colon":"","title-bold":"",className:"article-add-form",ref:"formRef",rules:$,data:o.value,onSubmit:l,onReset:h},{default:g(()=>[t(e,{title:"名称",field:"title",span:"24","item-render":{}},{default:g(()=>[t(I,{placeholder:"请输入分类名称","show-word-count":"",clearable:!0,"max-length":"20",modelValue:o.value.title,"onUpdate:modelValue":p[1]||(p[1]=c=>o.value.title=c)},null,8,["modelValue"])]),_:1}),t(e,{title:"节点属于",field:"pid",span:"24","item-render":{}},{default:g(()=>[t(R,{modelValue:o.value.pid,"onUpdate:modelValue":p[2]||(p[2]=c=>o.value.pid=c),"tree-config":_,options:k(a).treeList,"option-props":{label:"title",value:"id"}},null,8,["modelValue","options"])]),_:1}),t(e,{title:"排序",field:"sort",span:"24","item-render":{}},{default:g(()=>[t(w,{placeholder:"排序","show-word-count":"",type:"number",modelValue:o.value.sort,"onUpdate:modelValue":p[3]||(p[3]=c=>o.value.sort=c)},null,8,["modelValue"])]),_:1}),t(e,{title:"简介",field:"description",span:"24","item-render":{}},{default:g(()=>[t(V,{placeholder:"请输入分类简介","show-word-count":"","max-length":"200",rows:"5",modelValue:o.value.description,"onUpdate:modelValue":p[4]||(p[4]=c=>o.value.description=c)},null,8,["modelValue"])]),_:1}),t(e,{className:"article-add-submit-form",align:"right",span:"24"},{default:g(()=>[t(q,{type:"submit",status:"primary",content:"保存分类"}),t(q,{type:"reset",content:"重置表单"})]),_:1})]),_:1},8,["rules","data"])]),_:1},8,["title","modelValue"])])}}}),Oe=J(Me,[["__scopeId","data-v-1847b296"]]);export{Oe as default};
