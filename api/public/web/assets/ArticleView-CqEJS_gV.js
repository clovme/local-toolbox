import{d as j,u as Y,n as ee,r as V,q as ne,a as f,c as L,o as _,e as t,b as v,P as B,w as m,F,s as z,v as b,k as D,x as Q,f as R,t as $,V as M,_ as W,y as X,z as K,A as oe,h as le}from"./index-oCDbjsqw.js";import{u as te,t as Z,o as ae,p as se,d as ie}from"./article-1IGa94eg.js";const re={class:"article-content-box"},ue={class:"article-content-search"},ce={class:"article-content-tool"},de={class:"article-content-list-box"},ve={class:"title-box"},me={class:"options-time"},pe={class:"options-box"},fe=["onClick"],_e={class:"time"},ye={class:"article-content-list-right"},ge=j({__name:"ArticleContent",setup(U){const s=Y(),i=ee(),a=te(),p=V(s.query.kw),k=u=>{M.modal.confirm({title:"删除提示",content:`删除《${u.title}》？`,escClosable:!0,status:"warning",maskClosable:!0,draggable:!1,destroyOnClose:!0}).then(l=>{l==="confirm"&&ae("delete",u).then(y=>{M.modal.message({content:y.message,status:"success"}),p.value=s.query.kw,a.fetchCategoryTreeList(s.query,i),a.fetchArticleList(s.query)})})};ne(()=>s.query,u=>{p.value=u.kw,a.fetchArticleList(u)});const n=()=>{let u=s.query.cid,l=s.query.type;if(s.query.type==="all"){for(const y of a.treeList)if(y.name==="default"){u=y.id,l=y.name;break}}i.push({name:"EditArticle",params:{type:"add"},query:{cid:u,type:l,sort:s.query.sort}})},x=()=>{i.push({name:"Article",query:{...s.query,kw:p.value}})};return a.fetchArticleList(s.query),(u,l)=>{const y=f("vxe-input"),C=f("vxe-button"),q=f("router-link"),H=f("vxe-text-ellipsis");return _(),L("div",re,[t(B,{class:"article-content-tools"},{default:m(()=>[v("div",ue,[t(y,{onChange:x,"max-length":"50","show-word-count":"",modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=o=>p.value=o),placeholder:"请输入搜索内容",type:"search"},null,8,["modelValue"]),t(C,{onClick:x,content:"搜索"})]),v("div",ce,[t(C,{onClick:n,status:"danger",content:"新的创作","prefix-icon":"vxe-icon-add"})])]),_:1}),v("div",de,[t(B,{class:"article-content-list-content"},{default:m(()=>[(_(!0),L(F,null,z(b(a).articleTags.articleList,o=>(_(),L("div",{class:"article-content-list-item",key:o.id},[v("div",ve,[b(s).query.type==="all"?(_(),D(q,{key:0,class:"title-category",to:{name:"Article",query:{cid:o.categoryID,type:o.categoryName,sort:o.docSort}}},{default:m(()=>[R($(o.categoryTitle),1)]),_:2},1032,["to"])):Q("",!0),t(q,{class:"title-content",to:{name:"Preview",query:{id:o.id,cid:o.categoryID,type:o.categoryName,sort:o.docSort}}},{default:m(()=>[R($(o.title),1)]),_:2},1032,["to"])]),t(H,{class:"summary","line-clamp":"5",content:o.summary},null,8,["content"]),v("div",me,[v("div",pe,[t(q,{class:"options-box-edit",to:{name:"EditArticle",query:{id:o.id,cid:o.categoryID,type:o.categoryName,sort:o.docSort},params:{type:"edit"}}},{default:m(()=>[...l[1]||(l[1]=[R("编辑",-1)])]),_:1},8,["to"]),v("a",{onClick:I=>k(o),class:"options-box-delete",href:"javascript:void(0)"},"删除",8,fe)]),v("div",_e,[v("span",null,$(b(Z)(o.createdAt))+"发表",1),v("span",null,$(b(Z)(o.updatedAt))+"更新",1)])])]))),128))]),_:1}),v("div",ye,[t(B,{class:"article-content-list-right-card"},{default:m(()=>[(_(!0),L(F,null,z(b(a).articleTags.tags,(o,I)=>(_(),D(q,{to:{name:"Article",query:{...b(s).query,kw:o}},key:I},{default:m(()=>[R($(o),1)]),_:2},1032,["to"]))),128))]),_:1})])])])}}}),he=W(ge,[["__scopeId","data-v-60cf48e5"]]),xe={class:"vxe-menu--item-link-title"},Le={class:"vxe-menu--item-link-option-title"},ke={key:0,class:"vxe-menu--item-group"},we=j({name:"ArticleNavContent",__name:"ArticleNavContent",props:{level:{},navList:{}},emits:["add","edit","delete","up","down"],setup(U,{emit:s}){const i=U,a=s,p=Y(),k=X(()=>i.level??1),n=X(()=>String(i.navList.id)===p.query.id?!0:i.navList.children?.length?i.navList.children.some(e=>x(e)):!1);function x(e){return String(e.id)===p.query.id?!0:e.children?.length?e.children.some(g=>x(g)):!1}function u(e){e.isExpand=!e.isExpand}const l=V(null),y=V(null),C=V(null);function q(e){const w=e.currentTarget.getBoundingClientRect();clearTimeout(C.value),clearTimeout(y.value),y.value=window.setTimeout(()=>{if(!l.value){const A=document.createElement("ul");A.className="menu-item-options",A.style.position="fixed",A.style.padding="5px";const S=document.createElement("li");if(S.style.color="#409eff",S.innerHTML="添加新分类",S.addEventListener("click",d=>{d.stopPropagation(),a("add",i.navList),o()}),i.navList.name!=="all"&&i.navList.name!=="default"){const d=document.createElement("li");d.style.color="#67c23a",d.innerHTML=`编辑 [<b>${i.navList.title}</b>] 信息`,d.addEventListener("click",J=>{J.stopPropagation(),a("edit",i.navList),o()});const O=document.createElement("li");O.style.color="#f56c6c",O.innerHTML=`删除 [<b>${i.navList.title}</b>] 分类`,O.addEventListener("click",J=>{J.stopPropagation(),a("delete",i.navList),o()}),A.append(S,d,O)}else A.append(S);A.addEventListener("mouseenter",()=>{clearTimeout(C.value)}),A.addEventListener("mouseleave",()=>{C.value=window.setTimeout(()=>{o()},100)}),l.value=A}const h=l.value;document.body.appendChild(h);const E=h.offsetHeight,T=window.innerHeight;let N=w.top-E/2;N<0?N=5:N+E>T&&(N=T-E-5),h.style.left=`${w.right}px`,h.style.top=`${N}px`},200)}function H(){clearTimeout(y.value),C.value=window.setTimeout(()=>{o()},100)}function o(){l.value&&l.value.parentNode&&(l.value.parentNode.removeChild(l.value),l.value=null)}function I(e){a("add",e)}function G(e){a("edit",e)}function r(e){a("delete",e)}function c(e){a("up",e)}function P(e){a("down",e)}return(e,g)=>{const w=f("vxe-icon"),h=f("router-link"),E=f("ArticleNavContent",!0);return _(),L("div",{class:K(["vxe-menu--item-wrapper",{["vxe-menu--item-level"+k.value]:!0,"is--expand":e.navList.isExpand,"is--exact-active":b(p).query.cid===`${e.navList.id}`,"is--active":n.value}])},[t(h,{to:{name:"Article",query:{cid:e.navList.id,type:e.navList.name,sort:e.navList.docSort}},class:"vxe-menu--item-link"},{default:m(()=>[v("div",{class:K({"vxe-menu--item-link-icon":!0,"vxe-menu--item-link-icon--is-option":e.navList.name!=="all"&&e.navList.name!=="default"})},[t(w,{name:"file-markdown"}),t(w,{name:"information"})],2),v("div",xe,[v("div",Le,$(e.navList.title),1),v("div",{class:K({"vxe-menu--item-link-option-children":!e.navList.children?.length})},[v("div",{onMouseenter:q,onMouseleave:H,class:"vxe-menu--item-link-option"},[v("span",null,$(e.navList.articleCount<100?e.navList.articleCount:"99+"),1),t(w,{name:"ellipsis-v"})],32)],2)]),e.navList.children?.length?(_(),L("div",{key:0,class:"vxe-menu--item-link-collapse",onClick:g[0]||(g[0]=oe(T=>u(e.navList),["stop","prevent"]))},[e.navList.isExpand?(_(),D(w,{key:0,name:"arrow-down"})):(_(),D(w,{key:1,name:"arrow-left"}))])):Q("",!0)]),_:1},8,["to"]),e.navList.children?.length?(_(),L("div",ke,[(_(!0),L(F,null,z(e.navList.children,T=>(_(),D(E,{onUp:c,onDown:P,onAdd:I,onEdit:G,onDelete:r,navList:T,key:T.id,level:k.value+1},null,8,["navList","level"]))),128))])):Q("",!0)],2)}}}),Ae=W(we,[["__scopeId","data-v-e88a80d3"]]),be={class:"vxe-menu"},Ce={class:"vxe-menu--item-list"},Ve=j({name:"ArticleNav",__name:"ArticleNav",props:{modelValue:{}},emits:["update:modelValue","add","edit","delete"],setup(U,{emit:s}){const i=U,a=s,p=X({get:()=>i.modelValue,set:u=>a("update:modelValue",u)});function k(u){a("add",u)}function n(u){a("edit",u)}function x(u){a("delete",u)}return(u,l)=>(_(),L("div",be,[v("div",Ce,[(_(!0),L(F,null,z(p.value,y=>(_(),D(Ae,{onAdd:k,onEdit:n,onDelete:x,navList:y,key:y.id},null,8,["navList"]))),128))])]))}}),qe=W(Ve,[["__scopeId","data-v-52eb0737"]]),Ee={class:"article-box"},Te={class:"article-category-title"},Ne=j({__name:"ArticleView",setup(U){const s=Y(),i=ee(),a=V(!1),p=V(!1),k=V("添加文档分类"),n=V({docSort:"",id:"",pid:"",sort:0,title:"",isExpand:!0}),x=V(""),u={keyField:"value",expandAll:!0,parentField:"pid"},l=te(),y=()=>{se(a.value,n.value).then(r=>{p.value=!1,M.modal.message({content:r.message,status:"success"}),s.query.sort!==n.value.docSort&&i.push({name:"Article",query:{cid:s.query.cid,type:s.query.type,sort:n.value.docSort}}),l.fetchCategoryTreeList(s.query,i)})},C=()=>{M.modal.message({content:"重置事件",status:"info"})};function q(r){a.value=!0,n.value.id="0",n.value.pid=r.name!=="all"&&r.name!=="default"?r.id:"0",n.value.sort=0,n.value.isExpand=!0,n.value.docSort="updatedAt",k.value="添加文档分类",p.value=!0}function H(r){a.value=!1,n.value.id=r.id,n.value.pid=r.pid,n.value.title=r.title,n.value.sort=r.sort,n.value.isExpand=r.isExpand,n.value.docSort=r.docSort,k.value=`编辑[${r.title}]分类信息`,p.value=!0}function o(r){M.modal.confirm({title:"删除提示",content:`是否删除[${r.title}]分类信息？`,escClosable:!0,status:"warning",maskClosable:!0,draggable:!1,destroyOnClose:!0}).then(c=>{c==="confirm"&&ie(r).then(P=>{if(M.modal.message({content:P.message,status:"success"}),r.pid==="0"){if(!x.value){for(const e of l.categoryList)if(e.name==="default"){x.value=e.id;break}}i.push({name:"Article",query:{cid:x.value,type:"default"}})}else i.push({name:"Article",query:{cid:r.pid,type:r.name}});l.fetchCategoryTreeList(s.query,i)})})}const I=()=>new Promise(r=>{n.value={},r(null)}),G=le({title:[{required:!0,content:"分类名称不能为空"}],docSort:[{required:!0,content:"必须选择文档排序"}]});return l.fetchCategoryTreeList(s.query,i),(r,c)=>{const P=f("vxe-icon"),e=f("vxe-input"),g=f("vxe-form-item"),w=f("vxe-tree-select"),h=f("vxe-radio"),E=f("vxe-radio-group"),T=f("vxe-number-input"),N=f("vxe-button"),A=f("vxe-form"),S=f("vxe-modal");return _(),L("div",Ee,[t(B,{class:"article-category-box"},{default:m(()=>[v("div",Te,[t(P,{name:"file-word"}),c[7]||(c[7]=v("span",null,"文章分类列表",-1))]),t(qe,{onAdd:q,onEdit:H,onDelete:o,modelValue:b(l).categoryList,"onUpdate:modelValue":c[0]||(c[0]=d=>b(l).categoryList=d)},null,8,["modelValue"])]),_:1}),t(he),t(S,{"before-hide-method":I,title:k.value,modelValue:p.value,"onUpdate:modelValue":c[6]||(c[6]=d=>p.value=d),width:400,"lock-scroll":"",destroyOnClose:!0},{default:m(()=>[t(A,{vertical:"","title-colon":"","title-bold":"",className:"article-add-form",ref:"formRef",rules:G,data:n.value,onSubmit:y,onReset:C},{default:m(()=>[t(g,{title:"名称",field:"title",span:"24","item-render":{}},{default:m(()=>[t(e,{placeholder:"请输入分类名称","show-word-count":"",clearable:!0,"max-length":"20",modelValue:n.value.title,"onUpdate:modelValue":c[1]||(c[1]=d=>n.value.title=d)},null,8,["modelValue"])]),_:1}),t(g,{title:"节点属于",field:"pid",span:"24","item-render":{}},{default:m(()=>[t(w,{modelValue:n.value.pid,"onUpdate:modelValue":c[2]||(c[2]=d=>n.value.pid=d),"tree-config":u,options:b(l).rootTreeList,"option-props":{label:"title",value:"id"}},null,8,["modelValue","options"])]),_:1}),t(g,{title:"文档排序",field:"docSort",span:"24","item-render":{}},{default:m(()=>[t(E,{modelValue:n.value.docSort,"onUpdate:modelValue":c[3]||(c[3]=d=>n.value.docSort=d)},{default:m(()=>[t(h,{"checked-value":"title",content:"标题[升序]"}),t(h,{"checked-value":"updatedAt",content:"更新时间[降序]"}),t(h,{"checked-value":"createdAt",content:"创建时间[降序]"})]),_:1},8,["modelValue"])]),_:1}),t(g,{title:"子节点展开模式",field:"isExpand",span:"24","item-render":{}},{default:m(()=>[t(E,{modelValue:n.value.isExpand,"onUpdate:modelValue":c[4]||(c[4]=d=>n.value.isExpand=d)},{default:m(()=>[t(h,{checkedValue:!0,content:"展开(默认)"}),t(h,{checkedValue:!1,content:"收缩"})]),_:1},8,["modelValue"])]),_:1}),t(g,{title:"菜单排序",field:"sort",span:"24","item-render":{}},{default:m(()=>[t(T,{placeholder:"排序","show-word-count":"",type:"number",modelValue:n.value.sort,"onUpdate:modelValue":c[5]||(c[5]=d=>n.value.sort=d)},null,8,["modelValue"])]),_:1}),t(g,{className:"article-add-submit-form",align:"right",span:"24"},{default:m(()=>[t(N,{type:"submit",status:"primary",content:"保存分类"}),t(N,{type:"reset",content:"重置表单"})]),_:1})]),_:1},8,["rules","data"])]),_:1},8,["title","modelValue"])])}}}),Ie=W(Ne,[["__scopeId","data-v-7a1f8d28"]]);export{Ie as default};
