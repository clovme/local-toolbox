import{d as W,u as Z,n as te,r as C,q as oe,a as f,c as L,o as y,e as t,b as d,P as F,w as _,F as z,s as j,v as b,k as D,x as X,f as B,t as S,V as M,_ as G,y as Y,z as Q,A as le,h as ae}from"./index-DFpKp0Gk.js";import{t as ee}from"./index-ostf7RhG.js";import{u as ne,o as se,p as ie,d as re}from"./article-DLGrMOsc.js";const ce={class:"article-content-box"},ue={class:"article-content-search"},de={class:"article-content-tool"},ve={class:"article-content-list-box"},me={class:"title-box"},pe={class:"options-time"},fe={class:"options-box"},_e=["onClick"],ye={class:"time"},ge={class:"article-content-list-right"},he=W({__name:"ArticleContent",setup(U){const s=Z(),a=te(),l=ne(),m=C(s.query.kw),g=i=>{M.modal.confirm({title:"删除提示",content:`删除《${i.title}》？`,escClosable:!0,status:"warning",maskClosable:!0,draggable:!1,destroyOnClose:!0}).then(u=>{u==="confirm"&&se("delete",i).then(c=>{M.modal.message({content:c.message,status:"success"}),m.value=s.query.kw,l.fetchCategoryTreeList(s.query,a),l.fetchArticleList(s.query)})})};oe(()=>s.query,i=>{m.value=i.kw,l.fetchArticleList(i)});const n=()=>{let i=s.query.cid,u=s.query.type;if(s.query.type==="all"){for(const c of l.treeList)if(c.name==="default"){i=c.id,u=c.name;break}}a.push({name:"EditArticle",params:{type:"add"},query:{cid:i,type:u}})},k=()=>{a.push({name:"Article",query:{...s.query,kw:m.value}})};return l.fetchArticleList(s.query),(i,u)=>{const c=f("vxe-input"),V=f("vxe-button"),x=f("router-link"),H=f("vxe-text-ellipsis");return y(),L("div",ce,[t(F,{class:"article-content-tools"},{default:_(()=>[d("div",ue,[t(c,{onChange:k,"max-length":"50","show-word-count":"",modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=o=>m.value=o),placeholder:"请输入搜索内容",type:"search"},null,8,["modelValue"]),t(V,{onClick:k,content:"搜索"})]),d("div",de,[t(V,{onClick:n,status:"danger",content:"新的创作","prefix-icon":"vxe-icon-add"})])]),_:1}),d("div",ve,[t(F,{class:"article-content-list-content"},{default:_(()=>[(y(!0),L(z,null,j(b(l).articleTags.articleList,o=>(y(),L("div",{class:"article-content-list-item",key:o.id},[d("div",me,[b(s).query.type==="all"?(y(),D(x,{key:0,class:"title-category",to:{name:"Article",query:{cid:o.categoryID,type:o.categoryName,sort:o.docSort}}},{default:_(()=>[B(S(o.categoryTitle),1)]),_:2},1032,["to"])):X("",!0),t(x,{class:"title-content",to:{name:"Preview",query:{id:o.id,cid:o.categoryID,type:o.categoryName,sort:o.docSort}}},{default:_(()=>[B(S(o.title),1)]),_:2},1032,["to"])]),t(H,{class:"summary","line-clamp":"5",content:o.summary},null,8,["content"]),d("div",pe,[d("div",fe,[t(x,{class:"options-box-edit",to:{name:"EditArticle",query:{id:o.id,cid:o.categoryID,type:o.categoryName},params:{type:"edit"}}},{default:_(()=>[...u[1]||(u[1]=[B("编辑",-1)])]),_:1},8,["to"]),d("a",{onClick:w=>g(o),class:"options-box-delete",href:"javascript:void(0)"},"删除",8,_e)]),d("div",ye,[d("span",null,S(b(ee)(o.createdAt))+"前发表",1),d("span",null,S(b(ee)(o.updatedAt))+"前更新",1)])])]))),128))]),_:1}),d("div",ge,[t(F,{class:"article-content-list-right-card"},{default:_(()=>[(y(!0),L(z,null,j(b(l).articleTags.tags,(o,w)=>(y(),D(x,{to:{name:"Article",query:{...b(s).query,kw:o}},key:w},{default:_(()=>[B(S(o),1)]),_:2},1032,["to"]))),128))]),_:1})])])])}}}),xe=G(he,[["__scopeId","data-v-e71eda81"]]),Le={class:"vxe-menu--item-link-title"},ke={class:"vxe-menu--item-link-option-title"},we={key:0,class:"vxe-menu--item-group"},Ae=W({name:"ArticleNavContent",__name:"ArticleNavContent",props:{level:{},navList:{}},emits:["add","edit","delete","up","down"],setup(U,{emit:s}){const a=U,l=s,m=Z(),g=C({icon:!0,isExpand:!0}),n=Y(()=>a.level??1),k=Y(()=>String(a.navList.id)===m.query.id?!0:a.navList.children?.length?a.navList.children.some(e=>i(e)):!1);function i(e){return String(e.id)===m.query.id?!0:e.children?.length?e.children.some(O=>i(O)):!1}function u(){g.value.icon=!g.value.icon,g.value.isExpand=!g.value.isExpand}const c=C(null),V=C(null),x=C(null);function H(e){const h=e.currentTarget.getBoundingClientRect();clearTimeout(x.value),clearTimeout(V.value),V.value=window.setTimeout(()=>{if(!c.value){const A=document.createElement("ul");A.className="menu-item-options",A.style.position="fixed",A.style.padding="5px";const p=document.createElement("li");if(p.style.color="#409eff",p.innerHTML="添加新分类",p.addEventListener("click",I=>{I.stopPropagation(),l("add",a.navList),w()}),a.navList.name!=="all"&&a.navList.name!=="default"){const I=document.createElement("li");I.style.color="#67c23a",I.innerHTML=`编辑 [<b>${a.navList.title}</b>] 信息`,I.addEventListener("click",K=>{K.stopPropagation(),l("edit",a.navList),w()});const R=document.createElement("li");R.style.color="#f56c6c",R.innerHTML=`删除 [<b>${a.navList.title}</b>] 分类`,R.addEventListener("click",K=>{K.stopPropagation(),l("delete",a.navList),w()}),A.append(p,I,R)}else A.append(p);A.addEventListener("mouseenter",()=>{clearTimeout(x.value)}),A.addEventListener("mouseleave",()=>{x.value=window.setTimeout(()=>{w()},100)}),c.value=A}const q=c.value;document.body.appendChild(q);const E=q.offsetHeight,T=window.innerHeight;let N=h.top-E/2;N<0?N=5:N+E>T&&(N=T-E-5),q.style.left=`${h.right}px`,q.style.top=`${N}px`},200)}function o(){clearTimeout(V.value),x.value=window.setTimeout(()=>{w()},100)}function w(){c.value&&c.value.parentNode&&(c.value.parentNode.removeChild(c.value),c.value=null)}function J(e){l("add",e)}function r(e){l("edit",e)}function v(e){l("delete",e)}function P(e){l("up",e)}function $(e){l("down",e)}return(e,O)=>{const h=f("vxe-icon"),q=f("router-link"),E=f("ArticleNavContent",!0);return y(),L("div",{class:Q(["vxe-menu--item-wrapper",{["vxe-menu--item-level"+n.value]:!0,"is--expand":g.value.isExpand,"is--exact-active":b(m).query.cid===`${e.navList.id}`,"is--active":k.value}])},[t(q,{to:{name:"Article",query:{cid:e.navList.id,type:e.navList.name,sort:e.navList.docSort}},class:"vxe-menu--item-link"},{default:_(()=>[d("div",{class:Q({"vxe-menu--item-link-icon":!0,"vxe-menu--item-link-icon--is-option":e.navList.name!=="all"&&e.navList.name!=="default"})},[t(h,{name:"file-markdown"}),t(h,{name:"information"})],2),d("div",Le,[d("div",ke,S(e.navList.title),1),d("div",{class:Q({"vxe-menu--item-link-option-children":!e.navList.children?.length})},[d("div",{onMouseenter:H,onMouseleave:o,class:"vxe-menu--item-link-option"},[d("span",null,S(e.navList.articleCount<100?e.navList.articleCount:"99+"),1),t(h,{name:"ellipsis-v"})],32)],2)]),e.navList.children?.length?(y(),L("div",{key:0,class:"vxe-menu--item-link-collapse",onClick:le(u,["stop","prevent"])},[g.value.icon?(y(),D(h,{key:0,name:"arrow-down"})):(y(),D(h,{key:1,name:"arrow-left"}))])):X("",!0)]),_:1},8,["to"]),e.navList.children?.length?(y(),L("div",we,[(y(!0),L(z,null,j(e.navList.children,T=>(y(),D(E,{onUp:P,onDown:$,onAdd:J,onEdit:r,onDelete:v,navList:T,key:T.id,level:n.value+1},null,8,["navList","level"]))),128))])):X("",!0)],2)}}}),be=G(Ae,[["__scopeId","data-v-1d572501"]]),Ce={class:"vxe-menu"},Ve={class:"vxe-menu--item-list"},qe=W({name:"ArticleNav",__name:"ArticleNav",props:{modelValue:{}},emits:["update:modelValue","add","edit","delete"],setup(U,{emit:s}){const a=U,l=s,m=Y({get:()=>a.modelValue,set:i=>l("update:modelValue",i)});function g(i){l("add",i)}function n(i){l("edit",i)}function k(i){l("delete",i)}return(i,u)=>(y(),L("div",Ce,[d("div",Ve,[(y(!0),L(z,null,j(m.value,c=>(y(),D(be,{onAdd:g,onEdit:n,onDelete:k,navList:c,key:c.id},null,8,["navList"]))),128))])]))}}),Te=G(qe,[["__scopeId","data-v-52eb0737"]]),Ee={class:"article-box"},Ne={class:"article-category-title"},Se=W({__name:"ArticleView",setup(U){const s=Z(),a=te(),l=C(!1),m=C(!1),g=C("添加文档分类"),n=C({docSort:"",id:"",pid:"",sort:0,title:""}),k=C(""),i={keyField:"value",expandAll:!0,parentField:"pid"},u=ne(),c=()=>{ie(l.value,n.value).then(r=>{m.value=!1,M.modal.message({content:r.message,status:"success"}),s.query.sort!==n.value.docSort&&a.push({name:"Article",query:{cid:s.query.cid,type:s.query.type,sort:n.value.docSort}}),u.fetchCategoryTreeList(s.query,a)})},V=()=>{M.modal.message({content:"重置事件",status:"info"})};function x(r){l.value=!0,n.value.id="0",n.value.pid=r.name!=="all"&&r.name!=="default"?r.id:"0",n.value.sort=0,n.value.docSort="updatedAt",g.value="添加文档分类",m.value=!0}function H(r){l.value=!1,n.value.id=r.id,n.value.pid=r.pid,n.value.title=r.title,n.value.sort=r.sort,n.value.docSort=r.docSort,g.value=`编辑[${r.title}]分类信息`,m.value=!0}function o(r){M.modal.confirm({title:"删除提示",content:`是否删除[${r.title}]分类信息？`,escClosable:!0,status:"warning",maskClosable:!0,draggable:!1,destroyOnClose:!0}).then(v=>{v==="confirm"&&re(r).then(P=>{if(M.modal.message({content:P.message,status:"success"}),r.pid==="0"){if(!k.value){for(const $ of u.categoryList)if($.name==="default"){k.value=$.id;break}}a.push({name:"Article",query:{cid:k.value,type:"default"}})}else a.push({name:"Article",query:{cid:r.pid,type:r.name}});u.fetchCategoryTreeList(s.query,a)})})}const w=()=>new Promise(r=>{n.value={},r(null)}),J=ae({title:[{required:!0,content:"分类名称不能为空"}],docSort:[{required:!0,content:"必须选择文档排序"}]});return u.fetchCategoryTreeList(s.query,a),(r,v)=>{const P=f("vxe-icon"),$=f("vxe-input"),e=f("vxe-form-item"),O=f("vxe-tree-select"),h=f("vxe-radio"),q=f("vxe-radio-group"),E=f("vxe-number-input"),T=f("vxe-button"),N=f("vxe-form"),A=f("vxe-modal");return y(),L("div",Ee,[t(F,{class:"article-category-box"},{default:_(()=>[d("div",Ne,[t(P,{name:"file-word"}),v[6]||(v[6]=d("span",null,"文章分类列表",-1))]),t(Te,{onAdd:x,onEdit:H,onDelete:o,modelValue:b(u).categoryList,"onUpdate:modelValue":v[0]||(v[0]=p=>b(u).categoryList=p)},null,8,["modelValue"])]),_:1}),t(xe),t(A,{"before-hide-method":w,title:g.value,modelValue:m.value,"onUpdate:modelValue":v[5]||(v[5]=p=>m.value=p),width:400,draggable:!1,"lock-scroll":"",destroyOnClose:!0},{default:_(()=>[t(N,{vertical:"","title-colon":"","title-bold":"",className:"article-add-form",ref:"formRef",rules:J,data:n.value,onSubmit:c,onReset:V},{default:_(()=>[t(e,{title:"名称",field:"title",span:"24","item-render":{}},{default:_(()=>[t($,{placeholder:"请输入分类名称","show-word-count":"",clearable:!0,"max-length":"20",modelValue:n.value.title,"onUpdate:modelValue":v[1]||(v[1]=p=>n.value.title=p)},null,8,["modelValue"])]),_:1}),t(e,{title:"节点属于",field:"pid",span:"24","item-render":{}},{default:_(()=>[t(O,{modelValue:n.value.pid,"onUpdate:modelValue":v[2]||(v[2]=p=>n.value.pid=p),"tree-config":i,options:b(u).rootTreeList,"option-props":{label:"title",value:"id"}},null,8,["modelValue","options"])]),_:1}),t(e,{title:"文档排序",field:"docSort",span:"24","item-render":{}},{default:_(()=>[t(q,{modelValue:n.value.docSort,"onUpdate:modelValue":v[3]||(v[3]=p=>n.value.docSort=p)},{default:_(()=>[t(h,{"checked-value":"title",content:"标题[升序]"}),t(h,{"checked-value":"updatedAt",content:"更新时间[降序]"}),t(h,{"checked-value":"createdAt",content:"创建时间[降序]"})]),_:1},8,["modelValue"])]),_:1}),t(e,{title:"菜单排序",field:"sort",span:"24","item-render":{}},{default:_(()=>[t(E,{placeholder:"排序","show-word-count":"",type:"number",modelValue:n.value.sort,"onUpdate:modelValue":v[4]||(v[4]=p=>n.value.sort=p)},null,8,["modelValue"])]),_:1}),t(e,{className:"article-add-submit-form",align:"right",span:"24"},{default:_(()=>[t(T,{type:"submit",status:"primary",content:"保存分类"}),t(T,{type:"reset",content:"重置表单"})]),_:1})]),_:1},8,["rules","data"])]),_:1},8,["title","modelValue"])])}}}),De=G(Se,[["__scopeId","data-v-d4589161"]]);export{De as default};
